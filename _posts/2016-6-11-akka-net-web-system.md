---
layout: post
title:  "AKKA.NET для построения высоконадежных и слабосвязанных Web-систем"
date:   2016-06-11 15:15:29 +0300
categories: akka sharp
---
Для 99% сложных технических проблем, с которыми разработчики сталкиваются сегодня, было найдено решение в начале 1970 году: модель 
акторов.

Предпосылка актор-модели заключается в том, что каждый компонент в этой системе есть «актор», и между акторами происходит общение,
путем передачи сообщений между собой. Акторы имеют уникальные адреса внутри актор-системы, даже находясь на нескольких физических компьютерах, можно направить конкретное сообщение конкретному актору. У акторов также есть иерархия, родительские акторы контролируют дочерних, которые находятся на уровень ниже. Если дочерний актор внезапно выходит из строя, то родительский актор может принять решение о том, как поступить дальше.

Так чем же привлекательна модель актора? Основные преимущества:

1.	Акторы очень «дешевые» — вы можете создать 10 миллионов с минимальными системными затратами.
2.	Иерархия актора и наблюдение за дочерними, делает нашу систему самовосстанавливающейся и стабильной. 
3.	Актор-модель предоставляет простое API для параллельных вычислений.
4.	Удаленное взаимодействие между актор-системами упрощает маршрутизацию данных для каждого пользователя в определенном месте.
5.	Актор обрабатывает только одно сообщение из очереди.

Akka.NET предоставляет все эти возможности на языках C# и F#.

Устройство актора в Akka.NET включает себя поведение, «почтовый ящик», состояние, его «детей» и стратегию руководителя.

{:.center}
![Результат выполнения программы](http://blog.zverit.com/assets/aktor-body.png)

Актор должен быть защищен от воздействия извне. Таким образом, акторы доступны извне по ссылке, которые представлены объектом. Деление на внутренний и внешний объект обеспечивает прозрачность для всех операций. Но более важным аспектом является то, что нет возможности заглянуть во внутрь актора и получить его состояние снаружи.

Состояние. Объекты актора, как правило, содержат переменные, которые отражают его состояния. Это могут быть самые разные данные, которые делают актора полезным.

Поведение. Каждое сообщение переданное на обработку, будет сравниваться с поведением актора. Поведение означает функцию, с определенными действиями, которые будут предприняты в ответ на сообщения, например, записать данные пользователя и отправить уведомление об успешной операции записи. Поведение может изменяться с течением времени. Однако, первоначальное поведение определяются во время строительства его объекта, после перезапуска его поведение вернется в первоначальное состояние.

«Почтовый ящик». Целью актора является обработка сообщений, и эти сообщения принимаются из других акторов (или из пределов актор-системы). Место, куда приходят сообщения от других акторов называется «почтовый ящик». Актор имеет только один «почтовый ящик», где сообщения ставятся в очередь точно в том же порядке в каком они были получены. Примером сообщения служит обычный класс C#. 

«Дети». Каждый актор может стать руководителем. Если он создает детей, то он автоматически становится руководителем. Список «детей» хранится в контексте. 

Стратегия руководителя. В последней части актора находится стратегия для обработки ошибок его «детей». Устранение неисправностей в Akka становится довольно прозрачным, применяя стратегию отписки наблюдения и мониторинга, для всех кто вышел из строя.

{:.center}
![Результат выполнения программы](http://blog.zverit.com/assets/error-kernel-akka.png)

Akka.NET — это благо для производительности, так как программирование ее моделей просты — вместо того, чтобы писать код, который, к примеру, пытается  присвоить права компании для 100 000 пользователей параллельно, вместо этого мы можем написать не большую часть кода, который делает это определение для одного пользователя и запускает 100 000 экземпляров с минимальными затратами. 

Благодаря идеологии Akka.NET легко построить сложные, но надежные системы с простой реализацией, что гораздо облегчает дальнейшее их сопровождение. 


```cs
using (var actorSystem = ActorSystem.Create("DeliverySystem"))
{
  var recipientActor = actorSystem.ActorOf(Props.Create(() => new RecipientActor()), "receiver");
  var deliveryActor = actorSystem.ActorOf(Props.Create(() => new DeliveryActor(recipientActor)), "delivery");
  actorSystem.WhenTerminated.Wait();
}
```

{:.center}
->![Результат выполнения программы](http://blog.zverit.com/assets/akka-sample-result.png)<-
